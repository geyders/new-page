<!DOCTYPE html>
<html lang="uk">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dashboard Analytics</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <!-- login -->
  <div id="login" class="login-wrap">
    <form id="login-form" class="card" autocomplete="off" novalidate>
      <h2>–í—Ö—ñ–¥</h2>
      <div class="field">
        <label class="label" for="email">Email</label>
        <input id="email" class="input" type="email" placeholder="name@example.com" required />
        <div id="email-err" class="error">–í–≤–µ–¥—ñ—Ç—å –∫–æ—Ä–µ–∫—Ç–Ω–∏–π email</div>
      </div>
      <div class="field">
        <label class="label" for="password">–ü–∞—Ä–æ–ª—å</label>
        <input id="password" class="input" type="password" placeholder="–ù–µ –º–µ–Ω—à–µ 6 —Å–∏–º–≤–æ–ª—ñ–≤" required />
        <div id="pass-err" class="error">–ü–∞—Ä–æ–ª—å –º–∞—î –±—É—Ç–∏ ‚â• 6 —Å–∏–º–≤–æ–ª—ñ–≤</div>
      </div>
      <button class="btn" type="submit">–£–≤—ñ–π—Ç–∏</button>
    </form>
  </div>

  <button class="menu-toggle" aria-label="–ú–µ–Ω—é">‚ò∞</button>

  <aside class="sidebar" id="sidebar">
    <div class="brand">Dashboard</div>
    <ul class="menu">
      <li><a href="#todo" data-target="todo" class="active">ToDo</a></li>
      <li><a href="#analytics" data-target="analytics">Analytics</a></li>
      <li><a href="#tables" data-target="tables">Tables</a></li>
      <li><a href="#people" data-target="people">People</a></li>
      <li><a href="#settings" data-target="settings">Settings</a></li>
      <li><a href="#" id="logout" class="logout">Log out</a></li>
    </ul>
  </aside>

  <header class="topbar">
    <div class="search"><input type="text" placeholder="–ü–æ—à—É–∫‚Ä¶"></div>
    <label class="theme-switch" title="–¢–µ–º–∞">
      <input id="theme-toggle" type="checkbox" />
      <span class="slider"></span>
    </label>
  </header>

  <main class="main" id="app">
    <!-- ToDo -->
    <section id="todo" class="section active">
      <div class="section-content">
        <div class="to-do">
          <h1>Today</h1>
          <div class="grid">
            <div class="col">
              <h3>DESIGN</h3>
              <ul class="task-container" data-category="DESIGN"></ul>
            </div>
            <div class="col">
              <h3>PERSONAL</h3>
              <ul class="task-container" data-category="PERSONAL"></ul>
            </div>
            <div class="col">
              <h3>HOUSE</h3>
              <ul class="task-container" data-category="HOUSE"></ul>
            </div>
          </div>

          <div class="add-bar">
            <input id="task-input" type="text" placeholder="Write a task‚Ä¶" />
            <select id="task-cat">
              <option value="DESIGN">DESIGN</option>
              <option value="PERSONAL">PERSONAL</option>
              <option value="HOUSE">HOUSE</option>
            </select>
            <button id="add-task" class="add-btn" type="button">Add</button>
          </div>
        </div>
      </div>
    </section>

    <section id="analytics" class="section">
      <div class="section-content">
        <h2>Analytics</h2>
        <div class="analytics-grid">
          <div class="chart-container" data-chart-type="line">
            <h3>–ü—Ä–æ–¥–∞–∂—ñ –ø–æ –¥–Ω—è—Ö</h3>
            <canvas id="salesPerDay"></canvas>
          </div>

          <div class="chart-container" data-chart-type="bar">
            <h3>–õ—ñ–¥–∏ –ø–æ –¥–Ω—è—Ö</h3>
            <canvas id="leadsPerDay"></canvas>
          </div>

          <div class="chart-container" data-chart-type="pie">
            <h3>–ü–æ–≤—Ç–æ—Ä–Ω—ñ –ø–æ–∫—É–ø–∫–∏</h3>
            <canvas id="repeatPurchases"></canvas>
          </div>

          <div class="chart-container" data-chart-type="radar">
            <h3>–ü—Ä–æ–¥–∞–∂—ñ –ø–æ –º–µ–Ω–µ–¥–∂–µ—Ä–∞—Ö</h3>
            <canvas id="salesByManager"></canvas>
          </div>
          
          <!-- –î–æ–¥–∞–Ω–æ –≥—Ä–∞—Ñ—ñ–∫ –æ–±–æ—Ä–æ—Ç—É –ø–æ –º—ñ—Å—è—Ü—è—Ö -->
          <div class="chart-container" data-chart-type="bar">
            <h3>–û–±–æ—Ä–æ—Ç –ø–æ –º—ñ—Å—è—Ü—è—Ö</h3>
            <canvas id="monthlyTurnover"></canvas>
          </div>
        </div>
      </div>
    </section>

    <section id="tables" class="section">
      <div class="section-content">
        <div class="section-header">
          <h2>üìä –¢–∞–±–ª–∏—Ü—ñ –∞–Ω–∞–ª—ñ—Ç–∏–∫–∏</h2>
          <p>–î–µ—Ç–∞–ª—å–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–¥–∞–∂—ñ–≤ —Ç–∞ –æ–±—ñ–≥—É —Ç–æ–≤–∞—Ä—ñ–≤</p>
        </div>

        <div class="filters">
          <div class="filter-group">
            <label for="dateFilter">–§—ñ–ª—å—Ç—Ä –ø–æ –¥–∞—Ç—ñ:</label>
            <select id="dateFilter">
              <option value="all">–í—Å—ñ –¥–∞–Ω—ñ</option>
              <option value="week">–û—Å—Ç–∞–Ω–Ω—ñ–π —Ç–∏–∂–¥–µ–Ω—å</option>
              <option value="month">–û—Å—Ç–∞–Ω–Ω—ñ–π –º—ñ—Å—è—Ü—å</option>
              <option value="quarter">–û—Å—Ç–∞–Ω–Ω—ñ–π –∫–≤–∞—Ä—Ç–∞–ª</option>
            </select>
          </div>

          <div class="filter-group">
            <label for="searchInput">–ü–æ—à—É–∫:</label>
            <input type="text" id="searchInput" placeholder="–ü–æ—à—É–∫ –ø–æ –º–µ–Ω–µ–¥–∂–µ—Ä–∞–º –∞–±–æ —Ç–æ–≤–∞—Ä–∞–º...">
          </div>

          <button id="exportBtn" class="btn-primary">üìÑ –ï–∫—Å–ø–æ—Ä—Ç –≤ CSV</button>
        </div>

        <div class="tables-section">
          <div class="table-container">
            <h3>üë• –î–æ—Ö—ñ–¥ –ø–æ –º–µ–Ω–µ–¥–∂–µ—Ä–∞—Ö</h3>
            <div class="table-scroll">
              <table id="managersTable" class="analytics-table">
                <thead>
                  <tr>
                    <th data-sort="manager">Manager ‚ñæ</th>
                    <th data-sort="orders">Orders</th>
                    <th data-sort="revenue">Revenue</th>
                    <th data-sort="avgCheck">Avg Check</th>
                  </tr>
                </thead>
                <tbody>
                </tbody>
              </table>
            </div>
          </div>

          <div class="table-container">
            <h3>üì¶ –¢–æ–≤–∞—Ä–∏ –∑ –Ω–∏–∑—å–∫–∏–º –æ–±—ñ–≥–æ–º</h3>
            <div class="table-scroll">
              <table id="productsTable" class="analytics-table">
                <thead>
                  <tr>
                    <th data-sort="product">Product ‚ñæ</th>
                    <th data-sort="units">Units</th>
                    <th data-sort="revenue">Revenue</th>
                    <th data-sort="turnover">Turnover</th>
                  </tr>
                </thead>
                <tbody>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <div class="table-stats">
          <div class="stat-card">
            <h4>–ó–∞–≥–∞–ª—å–Ω–∏–π –¥–æ—Ö—ñ–¥</h4>
            <span id="totalRevenue">0 –≥—Ä–Ω</span>
          </div>
          <div class="stat-card">
            <h4>–ö—ñ–ª—å–∫—ñ—Å—Ç—å –º–µ–Ω–µ–¥–∂–µ—Ä—ñ–≤</h4>
            <span id="managersCount">0</span>
          </div>
          <div class="stat-card">
            <h4>–ö—ñ–ª—å–∫—ñ—Å—Ç—å —Ç–æ–≤–∞—Ä—ñ–≤</h4>
            <span id="productsCount">0</span>
          </div>
          <div class="stat-card">
            <h4>–°–µ—Ä–µ–¥–Ω—ñ–π —á–µ–∫</h4>
            <span id="avgCheck">0 –≥—Ä–Ω</span>
          </div>
        </div>
      </div>
    </section>

    <section id="people" class="section">
      <div class="section-content">
        <h2>People</h2>
        <p class="muted">–¢—É—Ç –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ.</p>
      </div>
    </section>

    <section id="settings" class="section">
      <div class="section-content">
        <h2>Settings</h2>
        <p class="muted">–¢—É—Ç –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è.</p>
      </div>
    </section>
  </main>

  <script>
    (function () {
      const qs = s => document.querySelector(s);
      const qsa = s => Array.from(document.querySelectorAll(s));

      window.charts = {};

      const loginWrap = qs('#login');
      const app = qs('#app');
      const loginForm = qs('#login-form');
      const emailInput = qs('#email');
      const passInput = qs('#password');
      const emailErr = qs('#email-err');
      const passErr = qs('#pass-err');

      function isEmail(v) { return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v); }
      function currentUser() { return localStorage.getItem('currentUser'); }
      function setUser(email) { localStorage.setItem('currentUser', email); }
      function clearUser() { localStorage.removeItem('currentUser'); }

      function showApp() {
        loginWrap.style.display = 'none';
        app.style.display = 'block';
      }
      function showLogin() {
        app.style.display = 'none';
        loginWrap.style.display = 'flex';
      }

      if (loginForm) {
        loginForm.addEventListener('submit', e => {
          e.preventDefault();
          const email = emailInput.value.trim().toLowerCase();
          const pass = passInput.value;

          let ok = true;
          if (!isEmail(email)) {
            emailErr.style.display = 'block';
            ok = false;
          } else {
            emailErr.style.display = 'none';
          }
          if (pass.length < 6) {
            passErr.style.display = 'block';
            ok = false;
          } else {
            passErr.style.display = 'none';
          }
          if (!ok) return;

          setUser(email);
          showApp();
          loadTasks();
          renderTasks();
        });
      }

      const themeToggle = qs('#theme-toggle');
      if (themeToggle) {
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme) {
          document.documentElement.setAttribute('data-theme', savedTheme);
          themeToggle.checked = savedTheme === 'dark';
        } else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
          document.documentElement.setAttribute('data-theme', 'dark');
          themeToggle.checked = true;
        }

        themeToggle.addEventListener('change', () => {
          const t = themeToggle.checked ? 'dark' : 'light';
          document.documentElement.setAttribute('data-theme', t);
          localStorage.setItem('theme', t);
        });
      }

      const sidebar = qs('#sidebar');
      const menuToggle = qs('.menu-toggle');
      if (menuToggle && sidebar) {
        menuToggle.addEventListener('click', () => sidebar.classList.toggle('open'));
      }

      function switchTab(tabName) {
        document.querySelectorAll('.section').forEach(section => {
          section.classList.remove('active');
        });

        document.querySelectorAll('.menu a').forEach(link => {
          link.classList.remove('active');
        });

        const targetSection = document.getElementById(tabName);
        if (targetSection) {
          targetSection.classList.add('active');
        }

        const activeLink = document.querySelector(`a[data-target="${tabName}"]`);
        if (activeLink) {
          activeLink.classList.add('active');
        }

        if (tabName === 'analytics') {
          loadAnalytics();
        } else if (tabName === 'tables') {
          loadTables();
        }
      }

      const links = qsa('.menu a[data-target]');
      links.forEach(a => {
        a.addEventListener('click', e => {
          e.preventDefault();
          const id = a.dataset.target;
          switchTab(id);
        });
      });

      const logoutBtn = qs('#logout');
      if (logoutBtn) {
        logoutBtn.addEventListener('click', e => {
          e.preventDefault();
          clearUser();
          showLogin();
          if (loginForm) loginForm.reset();
        });
      }

      let tasks = [];
      const containers = () => qsa('.task-container');
      const tasksKey = () => 'tasks_' + (currentUser() || 'guest');

      function loadTasks() {
        const stored = localStorage.getItem(tasksKey());
        tasks = stored ? JSON.parse(stored) : [];
      }

      function saveTasks() {
        localStorage.setItem(tasksKey(), JSON.stringify(tasks));
      }

      function renderTasks() {
        const taskContainers = containers();
        if (!taskContainers.length) return;

        taskContainers.forEach(c => c.innerHTML = '');

        tasks.forEach(t => {
          const li = document.createElement('li');
          li.className = 'task' + (t.completed ? ' completed' : '');
          li.draggable = true;
          li.dataset.id = t.id;

          const cb = document.createElement('input');
          cb.type = 'checkbox';
          cb.checked = t.completed;
          cb.addEventListener('change', () => toggleTask(t.id));

          const p = document.createElement('p');
          p.textContent = t.text;

          li.appendChild(cb);
          li.appendChild(p);

          const bucket = document.querySelector(`.task-container[data-category="${t.category}"]`);
          (bucket || document.querySelector('.task-container[data-category="DESIGN"]')).appendChild(li);

          li.addEventListener('dragstart', () => li.classList.add('dragging'));
          li.addEventListener('dragend', () => li.classList.remove('dragging'));
        });

        taskContainers.forEach(c => {
          c.ondragover = e => e.preventDefault();
          c.ondrop = () => {
            const dragging = document.querySelector('.dragging');
            if (!dragging) return;
            const id = Number(dragging.dataset.id);
            const task = tasks.find(x => x.id === id);
            if (!task) return;
            task.category = c.dataset.category;
            saveTasks();
            renderTasks();
          };
        });
      }

      function addTask() {
        const input = qs('#task-input');
        const catSel = qs('#task-cat');
        if (!input || !catSel) return;

        const text = (input.value || '').trim();
        if (!text) return alert('–í–≤–µ–¥—ñ—Ç—å –∑–∞–¥–∞—á—É');

        const task = {
          id: Date.now(),
          text,
          completed: false,
          category: catSel.value || 'DESIGN'
        };

        tasks.push(task);
        saveTasks();
        input.value = '';
        renderTasks();
      }

      function toggleTask(id) {
        const t = tasks.find(x => x.id === id);
        if (!t) return;
        t.completed = !t.completed;
        saveTasks();
        renderTasks();
      }

      const addTaskBtn = qs('#add-task');
      if (addTaskBtn) {
        addTaskBtn.addEventListener('click', addTask);
      }

      if (currentUser()) {
        showApp();
        loadTasks();
        renderTasks();
      } else {
        showLogin();
      }
    })();

    async function loadSalesData() {
      try {
        // –î–µ–º–æ-–¥–∞–Ω—ñ –∑ –ø—Ä–æ–¥–∞–∂–∞–º–∏ –∑–∞ –∫—ñ–ª—å–∫–∞ –º—ñ—Å—è—Ü—ñ–≤
        const demoData = {
          sales: [
            { date: "2025-01-05", amount: 1200, manager: "–Ü–≤–∞–Ω –ü–µ—Ç—Ä–µ–Ω–∫–æ", product: "–ù–æ—É—Ç–±—É–∫", isLead: true },
            { date: "2025-01-12", amount: 800, manager: "–ú–∞—Ä—ñ—è –ö–æ–≤–∞–ª—å", product: "–ú–∏—à–∫–∞", isLead: false },
            { date: "2025-01-18", amount: 2500, manager: "–Ü–≤–∞–Ω –ü–µ—Ç—Ä–µ–Ω–∫–æ", product: "–ú–æ–Ω—ñ—Ç–æ—Ä", isLead: true },
            { date: "2025-01-25", amount: 500, manager: "–û–ª–µ–∫—Å—ñ–π –°—ñ–¥–æ—Ä–µ–Ω–∫–æ", product: "–ö–ª–∞–≤—ñ–∞—Ç—É—Ä–∞", isLead: true },
            { date: "2025-02-01", amount: 1800, manager: "–ú–∞—Ä—ñ—è –ö–æ–≤–∞–ª—å", product: "–ù–æ—É—Ç–±—É–∫", isLead: false },
            { date: "2025-02-01", amount: 950, manager: "–û–ª–µ–∫—Å—ñ–π –°—ñ–¥–æ—Ä–µ–Ω–∫–æ", product: "–ù–∞–≤—É—à–Ω–∏–∫–∏", isLead: true },
            { date: "2025-02-02", amount: 3000, manager: "–Ü–≤–∞–Ω –ü–µ—Ç—Ä–µ–Ω–∫–æ", product: "–¢–µ–ª–µ—Ñ–æ–Ω", isLead: true },
            { date: "2025-02-02", amount: 450, manager: "–ú–∞—Ä—ñ—è –ö–æ–≤–∞–ª—å", product: "–ß–æ—Ö–æ–ª", isLead: false },
            { date: "2025-02-03", amount: 1200, manager: "–û–ª–µ–∫—Å—ñ–π –°—ñ–¥–æ—Ä–µ–Ω–∫–æ", product: "–ü–ª–∞–Ω—à–µ—Ç", isLead: true },
            { date: "2025-02-03", amount: 700, manager: "–Ü–≤–∞–Ω –ü–µ—Ç—Ä–µ–Ω–∫–æ", product: "–ö–∞–±–µ–ª—å", isLead: false },
            { date: "2025-02-04", amount: 2100, manager: "–ú–∞—Ä—ñ—è –ö–æ–≤–∞–ª—å", product: "–ù–æ—É—Ç–±—É–∫", isLead: true },
            { date: "2025-02-04", amount: 850, manager: "–û–ª–µ–∫—Å—ñ–π –°—ñ–¥–æ—Ä–µ–Ω–∫–æ", product: "–ú–∏—à–∫–∞", isLead: false },
            { date: "2025-02-05", amount: 1700, manager: "–Ü–≤–∞–Ω –ü–µ—Ç—Ä–µ–Ω–∫–æ", product: "–ú–æ–Ω—ñ—Ç–æ—Ä", isLead: true },
            { date: "2025-02-05", amount: 400, manager: "–ú–∞—Ä—ñ—è –ö–æ–≤–∞–ª—å", product: "–ö–ª–∞–≤—ñ–∞—Ç—É—Ä–∞", isLead: false },
            { date: "2025-02-06", amount: 3200, manager: "–û–ª–µ–∫—Å—ñ–π –°—ñ–¥–æ—Ä–µ–Ω–∫–æ", product: "–¢–µ–ª–µ—Ñ–æ–Ω", isLead: true },
            { date: "2025-02-06", amount: 550, manager: "–Ü–≤–∞–Ω –ü–µ—Ç—Ä–µ–Ω–∫–æ", product: "–ß–æ—Ö–æ–ª", isLead: false },
            { date: "2025-02-07", amount: 1400, manager: "–ú–∞—Ä—ñ—è –ö–æ–≤–∞–ª—å", product: "–ü–ª–∞–Ω—à–µ—Ç", isLead: true },
            { date: "2025-02-07", amount: 900, manager: "–û–ª–µ–∫—Å—ñ–π –°—ñ–¥–æ—Ä–µ–Ω–∫–æ", product: "–ù–∞–≤—É—à–Ω–∏–∫–∏", isLead: true },
            { date: "2025-02-08", amount: 2300, manager: "–Ü–≤–∞–Ω –ü–µ—Ç—Ä–µ–Ω–∫–æ", product: "–ù–æ—É—Ç–±—É–∫", isLead: true },
            { date: "2025-02-08", amount: 600, manager: "–ú–∞—Ä—ñ—è –ö–æ–≤–∞–ª—å", product: "–ö–∞–±–µ–ª—å", isLead: false },
            { date: "2025-03-01", amount: 2800, manager: "–Ü–≤–∞–Ω –ü–µ—Ç—Ä–µ–Ω–∫–æ", product: "–¢–µ–ª–µ—Ñ–æ–Ω", isLead: true },
            { date: "2025-03-05", amount: 1200, manager: "–ú–∞—Ä—ñ—è –ö–æ–≤–∞–ª—å", product: "–ü–ª–∞–Ω—à–µ—Ç", isLead: true },
            { date: "2025-03-10", amount: 900, manager: "–û–ª–µ–∫—Å—ñ–π –°—ñ–¥–æ—Ä–µ–Ω–∫–æ", product: "–ù–∞–≤—É—à–Ω–∏–∫–∏", isLead: false },
            { date: "2025-03-15", amount: 3500, manager: "–Ü–≤–∞–Ω –ü–µ—Ç—Ä–µ–Ω–∫–æ", product: "–ù–æ—É—Ç–±—É–∫", isLead: true },
            { date: "2025-03-20", amount: 750, manager: "–ú–∞—Ä—ñ—è –ö–æ–≤–∞–ª—å", product: "–ú–∏—à–∫–∞", isLead: false },
            { date: "2025-03-25", amount: 2200, manager: "–û–ª–µ–∫—Å—ñ–π –°—ñ–¥–æ—Ä–µ–Ω–∫–æ", product: "–ú–æ–Ω—ñ—Ç–æ—Ä", isLead: true },
            { date: "2025-04-02", amount: 1800, manager: "–Ü–≤–∞–Ω –ü–µ—Ç—Ä–µ–Ω–∫–æ", product: "–ü–ª–∞–Ω—à–µ—Ç", isLead: true },
            { date: "2025-04-07", amount: 950, manager: "–ú–∞—Ä—ñ—è –ö–æ–≤–∞–ª—å", product: "–ù–∞–≤—É—à–Ω–∏–∫–∏", isLead: false },
            { date: "2025-04-12", amount: 4200, manager: "–û–ª–µ–∫—Å—ñ–π –°—ñ–¥–æ—Ä–µ–Ω–∫–æ", product: "–ù–æ—É—Ç–±—É–∫", isLead: true },
            { date: "2025-04-18", amount: 650, manager: "–Ü–≤–∞–Ω –ü–µ—Ç—Ä–µ–Ω–∫–æ", product: "–ö–ª–∞–≤—ñ–∞—Ç—É—Ä–∞", isLead: false },
            { date: "2025-04-22", amount: 3100, manager: "–ú–∞—Ä—ñ—è –ö–æ–≤–∞–ª—å", product: "–¢–µ–ª–µ—Ñ–æ–Ω", isLead: true },
            { date: "2025-04-28", amount: 1250, manager: "–û–ª–µ–∫—Å—ñ–π –°—ñ–¥–æ—Ä–µ–Ω–∫–æ", product: "–ß–æ—Ö–æ–ª", isLead: false }
          ]
        };

        return demoData;
      } catch (error) {
        console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö:', error);
        throw error;
      }
    }

    async function loadAnalytics() {
      try {
        const analyticsSection = document.getElementById('analytics');
        if (!analyticsSection || !analyticsSection.classList.contains('active')) return;

        const salesData = await loadSalesData();
        const sales = salesData.sales;

        if (!sales || sales.length === 0) {
          throw new Error('–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö –¥–ª—è –∞–Ω–∞–ª—ñ—Ç–∏–∫–∏');
        }

        console.log(`–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ ${sales.length} –∑–∞–ø–∏—Å—ñ–≤`);

        createCharts(sales);

      } catch (err) {
        console.error("–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∞–Ω–∞–ª—ñ—Ç–∏–∫–∏:", err);
        alert("–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∞–Ω–∞–ª—ñ—Ç–∏–∫–∏: " + err.message);
      }
    }

    function createCharts(sales) {
      // –û—á–∏—â–µ–Ω–Ω—è —ñ—Å–Ω—É—é—á–∏—Ö –≥—Ä–∞—Ñ—ñ–∫—ñ–≤
      Object.values(window.charts).forEach(chart => {
        if (chart && typeof chart.destroy === 'function') {
          chart.destroy();
        }
      });
      window.charts = {};

      // –ì—Ä–∞—Ñ—ñ–∫ –ø—Ä–æ–¥–∞–∂—ñ–≤ –ø–æ –¥–Ω—è—Ö
      const dailySales = {};
      sales.forEach(s => {
        dailySales[s.date] = (dailySales[s.date] || 0) + s.amount;
      });

      const sortedDates = Object.keys(dailySales).sort();
      const sortedSales = sortedDates.map(date => dailySales[date]);

      if (window.Chart && document.getElementById("salesPerDay")) {
        window.charts.salesPerDay = new Chart(document.getElementById("salesPerDay"), {
          type: "line",
          data: {
            labels: sortedDates,
            datasets: [{
              label: "–ü—Ä–æ–¥–∞–∂—ñ (–≥—Ä–Ω)",
              data: sortedSales,
              borderColor: "#4e8cff",
              backgroundColor: "rgba(78, 140, 255, 0.1)",
              fill: true,
              tension: 0.4
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              title: {
                display: true,
                text: '–ü—Ä–æ–¥–∞–∂—ñ –ø–æ –¥–Ω—è—Ö'
              }
            }
          }
        });
      }

      // –ì—Ä–∞—Ñ—ñ–∫ –ª—ñ–¥—ñ–≤ –ø–æ –¥–Ω—è—Ö
      const dailyLeads = {};
      sales.forEach(s => {
        if (s.isLead) {
          dailyLeads[s.date] = (dailyLeads[s.date] || 0) + 1;
        }
      });

      const sortedLeadDates = Object.keys(dailyLeads).sort();
      const sortedLeads = sortedLeadDates.map(date => dailyLeads[date]);

      if (window.Chart && document.getElementById("leadsPerDay")) {
        window.charts.leadsPerDay = new Chart(document.getElementById("leadsPerDay"), {
          type: "bar",
          data: {
            labels: sortedLeadDates,
            datasets: [{
              label: "–õ—ñ–¥–∏",
              data: sortedLeads,
              backgroundColor: "#10b981",
              borderColor: "#0d966c",
              borderWidth: 1
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              title: {
                display: true,
                text: '–õ—ñ–¥–∏ –ø–æ –¥–Ω—è—Ö'
              }
            }
          }
        });
      }

      // –ö—Ä—É–≥–æ–≤–∞ –¥—ñ–∞–≥—Ä–∞–º–∞ –ø–æ–≤—Ç–æ—Ä–Ω–∏—Ö –ø–æ–∫—É–ø–æ–∫
      const repeatCustomers = {};
      sales.forEach(s => {
        repeatCustomers[s.product] = (repeatCustomers[s.product] || 0) + 1;
      });

      if (window.Chart && document.getElementById("repeatPurchases")) {
        window.charts.repeatPurchases = new Chart(document.getElementById("repeatPurchases"), {
          type: "pie",
          data: {
            labels: Object.keys(repeatCustomers),
            datasets: [{
              data: Object.values(repeatCustomers),
              backgroundColor: [
                "#4e8cff", "#10b981", "#ef4444", "#ffc107", "#6f42c1",
                "#8b5cf6", "#ec4899", "#f97316", "#06b6d4", "#84cc16"
              ]
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              title: {
                display: true,
                text: '–ü–æ–≤—Ç–æ—Ä–Ω—ñ –ø–æ–∫—É–ø–∫–∏ –ø–æ –ø—Ä–æ–¥—É–∫—Ç–∞—Ö'
              }
            }
          }
        });
      }

      // –†–∞–¥–∞—Ä–Ω–∞ –¥—ñ–∞–≥—Ä–∞–º–∞ –ø—Ä–æ–¥–∞–∂—ñ–≤ –ø–æ –º–µ–Ω–µ–¥–∂–µ—Ä–∞—Ö
      const managerRevenue = {};
      sales.forEach(s => {
        managerRevenue[s.manager] = (managerRevenue[s.manager] || 0) + s.amount;
      });

      if (window.Chart && document.getElementById("salesByManager")) {
        window.charts.salesByManager = new Chart(document.getElementById("salesByManager"), {
          type: "radar",
          data: {
            labels: Object.keys(managerRevenue),
            datasets: [{
              label: "–ü—Ä–æ–¥–∞–∂—ñ (–≥—Ä–Ω)",
              data: Object.values(managerRevenue),
              backgroundColor: "rgba(78, 140, 255, 0.2)",
              borderColor: "#4e8cff",
              pointBackgroundColor: "#4e8cff",
              pointBorderColor: "#fff",
              pointHoverBackgroundColor: "#fff",
              pointHoverBorderColor: "#4e8cff"
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              title: {
                display: true,
                text: '–ü—Ä–æ–¥–∞–∂—ñ –ø–æ –º–µ–Ω–µ–¥–∂–µ—Ä–∞—Ö'
              }
            }
          }
        });
      }

      const monthlyTurnover = {};
      sales.forEach(s => {
        const date = new Date(s.date);
        const monthYear = `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}`;
        monthlyTurnover[monthYear] = (monthlyTurnover[monthYear] || 0) + s.amount;
      });

      const sortedMonths = Object.keys(monthlyTurnover).sort();
      const sortedMonthlyTurnover = sortedMonths.map(month => monthlyTurnover[month]);

      const formattedMonths = sortedMonths.map(month => {
        const [year, monthNum] = month.split('-');
        const monthNames = ['–°—ñ—á', '–õ—é—Ç', '–ë–µ—Ä', '–ö–≤—ñ', '–¢—Ä–∞', '–ß–µ—Ä', '–õ–∏–ø', '–°–µ—Ä', '–í–µ—Ä', '–ñ–æ–≤', '–õ–∏—Å', '–ì—Ä—É'];
        return `${monthNames[parseInt(monthNum) - 1]} ${year}`;
      });

      if (window.Chart && document.getElementById("monthlyTurnover")) {
        window.charts.monthlyTurnover = new Chart(document.getElementById("monthlyTurnover"), {
          type: "bar",
          data: {
            labels: formattedMonths,
            datasets: [{
              label: "–û–±–æ—Ä–æ—Ç (–≥—Ä–Ω)",
              data: sortedMonthlyTurnover,
              backgroundColor: "#8b5cf6",
              borderColor: "#6f42c1",
              borderWidth: 1
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              title: {
                display: true,
                text: '–û–±–æ—Ä–æ—Ç –ø–æ –º—ñ—Å—è—Ü—è—Ö'
              }
            },
            scales: {
              y: {
                beginAtZero: true
              }
            }
          }
        });
      }
    }

    async function loadTables() {
      const tablesSection = document.getElementById('tables');
      if (!tablesSection || !tablesSection.classList.contains('active')) return;

      try {
        const salesData = await loadSalesData();
        const sales = salesData.sales;

        createTables(sales);
        updateTableStats(sales);

      } catch (err) {
        console.error("–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ç–∞–±–ª–∏—Ü—å:", err);
        alert("–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ç–∞–±–ª–∏—Ü—å: " + err.message);
      }
    }

    function createTables(sales) {
      const managers = {};
      sales.forEach(sale => {
        if (!managers[sale.manager]) {
          managers[sale.manager] = { orders: 0, revenue: 0 };
        }
        managers[sale.manager].orders++;
        managers[sale.manager].revenue += sale.amount;
      });

      const managersTable = document.querySelector('#managersTable tbody');
      if (managersTable) {
        managersTable.innerHTML = '';
        Object.entries(managers).forEach(([manager, data]) => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${manager}</td>
            <td>${data.orders}</td>
            <td>${data.revenue.toFixed(2)} –≥—Ä–Ω</td>
            <td>${(data.revenue / data.orders).toFixed(2)} –≥—Ä–Ω</td>
          `;
          managersTable.appendChild(row);
        });
      }

      const products = {};
      sales.forEach(sale => {
        if (!products[sale.product]) {
          products[sale.product] = { units: 0, revenue: 0 };
        }
        products[sale.product].units++;
        products[sale.product].revenue += sale.amount;
      });

      const productsTable = document.querySelector('#productsTable tbody');
      if (productsTable) {
        productsTable.innerHTML = '';
        Object.entries(products).forEach(([product, data]) => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${product}</td>
            <td>${data.units}</td>
            <td>${data.revenue.toFixed(2)} –≥—Ä–Ω</td>
            <td>${(data.revenue / data.units).toFixed(2)}</td>
          `;
          productsTable.appendChild(row);
        });
      }
    }

    function updateTableStats(sales) {
      const totalRevenue = sales.reduce((sum, sale) => sum + sale.amount, 0);
      const managers = new Set(sales.map(sale => sale.manager));
      const products = new Set(sales.map(sale => sale.product));
      const avgCheck = totalRevenue / sales.length;

      document.getElementById('totalRevenue').textContent = `${totalRevenue.toFixed(2)} –≥—Ä–Ω`;
      document.getElementById('managersCount').textContent = managers.size;
      document.getElementById('productsCount').textContent = products.size;
      document.getElementById('avgCheck').textContent = `${avgCheck.toFixed(2)} –≥—Ä–Ω`;
    }

    document.addEventListener('DOMContentLoaded', function () {
      const analyticsLink = document.querySelector('a[data-target="analytics"]');
      if (analyticsLink) {
        analyticsLink.addEventListener("click", loadAnalytics);
      }

      const tablesLink = document.querySelector('a[data-target="tables"]');
      if (tablesLink) {
        tablesLink.addEventListener("click", loadTables);
      }

      const exportBtn = document.getElementById('exportBtn');
      if (exportBtn) {
        exportBtn.addEventListener('click', exportToCSV);
      }
    });

    function exportToCSV() {
      alert("–§—É–Ω–∫—Ü—ñ—è –µ–∫—Å–ø–æ—Ä—Ç—É –≤ CSV –±—É–¥–µ —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–∞ —Ç—É—Ç");
    }

    async function loadPeople() {
      const peopleSection = document.getElementById('people');
      if (!peopleSection || !peopleSection.classList.contains('active')) return;

      try {

        peopleSection.querySelector('.section-content').innerHTML = `
          <h2>People</h2>
          <div class="loading">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö...</div>
        `;

        const response = await fetch('https://jsonplaceholder.typicode.com/users');

        if (!response.ok) {
          throw new Error('–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –¥–∞–Ω—ñ');
        }

        const users = await response.json();

        displayUsers(users);
      } catch (err) {
        console.error("–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –ª—é–¥–µ–π:", err);
        peopleSection.querySelector('.section-content').innerHTML = `
          <h2>People</h2>
          <div class="error">–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è: ${err.message}</div>
        `;
      }
    }

    function displayUsers(users) {
      const peopleSection = document.getElementById('people');
      const sectionContent = peopleSection.querySelector('.section-content');

      let usersHTML = `
        <h2>People</h2>
        <p class="muted">–¢—É—Ç –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –∑ API.</p>
        <div class="people-grid">
      `;

      users.forEach(user => {
        usersHTML += `
          <div class="people-card">
            <h3>${user.name}</h3>
            <p><strong>Email:</strong> ${user.email}</p>
            <p><strong>Phone:</strong> ${user.phone}</p>
            <p><strong>Company:</strong> ${user.company.name}</p>
          </div>
        `;
      });

      usersHTML += `</div>`;

      sectionContent.innerHTML = usersHTML;
    }

    document.addEventListener('DOMContentLoaded', function () {
      const analyticsLink = document.querySelector('a[data-target="analytics"]');
      if (analyticsLink) {
        analyticsLink.addEventListener("click", loadAnalytics);
      }

      const tablesLink = document.querySelector('a[data-target="tables"]');
      if (tablesLink) {
        tablesLink.addEventListener("click", loadTables);
      }

      const peopleLink = document.querySelector('a[data-target="people"]');
      if (peopleLink) {
        peopleLink.addEventListener("click", loadPeople);
      }

      const exportBtn = document.getElementById('exportBtn');
      if (exportBtn) {
        exportBtn.addEventListener('click', exportToCSV);
      }
    });
  </script>
</body>

</html>